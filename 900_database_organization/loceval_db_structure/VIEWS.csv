schema,view,query,rules,SELECT,UPDATE,purpose,excluded
outbound,OrthophotoAssessment,"SELECT  LOC.*,  LOCASS.locationassessment_id,  (SLOC.location_id IS NULL) AS sample_location_obsolete,  SLOC.grts_join_method,  SLOC.sp_poststratum,  SLOC.scheme_ps_targetpanels,  SLOC.type,  SLOC.assessment,  SLOC.assessment_date,  LOCASS.cell_disapproved,  LOCASS.revisit_disapproval,  LOCASS.disapproval_explanation,  LOCASS.type_suggested,  LOCASS.implications_habitatmap,  LOCASS.feedback_habitatmap,  LOCASS.notes,  LOCASS.assessment_doneFROM ""outbound"".""LocationAssessments"" AS LOCASSLEFT JOIN ""metadata"".""Locations"" AS LOC  ON LOC.location_id = LOCASS.location_idLEFT JOIN ""outbound"".""SampleLocations"" AS SLOC  ON (LOCASS.type = SLOC.type     AND LOCASS.grts_address = SLOC.grts_address     );","DROP RULE IF EXISTS OrthophotoAssessment_upd ON ""outbound"".""OrthophotoAssessment"";CREATE RULE OrthophotoAssessment_upd ASON UPDATE TO ""outbound"".""OrthophotoAssessment""DO INSTEAD UPDATE ""outbound"".""LocationAssessments"" SET  type_suggested = NEW.type_suggested,  cell_disapproved = NEW.cell_disapproved,  revisit_disapproval = NEW.revisit_disapproval,  disapproval_explanation = NEW.disapproval_explanation,  implications_habitatmap = NEW.implications_habitatmap,  feedback_habitatmap = NEW.feedback_habitatmap,  notes = NEW.notes,  assessment_done = NEW.assessment_done WHERE locationassessment_id = OLD.locationassessment_id;","ward,karen,floris","ward,karen,floris","field preparation: combination of Locations, SampleLocations, and LocationAssessments,with the purpose of orthophoto (and other) assessments in praetorio",0
inbound,LocationEvaluation,"SELECT  LOC.*,  EVI.extravisit_id,  EVI.grouped_activity_id,  EVI.teammember_id,  EVI.date_visit,  EVI.type_assessed,  EVI.notes,  EVI.photo,  EVI.visit_done,  SLOC.grts_join_method,  SLOC.scheme,  SLOC.panel_set,  SLOC.targetpanel,  SLOC.scheme_ps_targetpanels,  SLOC.sp_poststratum,  SLOC.type,  SLOC.assessment,  SLOC.assessment_date,  SLOC.is_replaced,  LOCASS.notes AS location_assessmentFROM ""inbound"".""ExtraVisits"" AS EVILEFT JOIN ""metadata"".""Locations"" AS LOC  ON LOC.location_id = EVI.location_idLEFT JOIN ""outbound"".""SampleLocations"" AS SLOC  ON EVI.samplelocation_id = SLOC.samplelocation_idLEFT JOIN (  SELECT    location_id,    cell_disapproved,    assessment_done,    notes  FROM ""outbound"".""LocationAssessments""  ) AS LOCASS  ON EVI.location_id = LOCASS.location_idWHERE TRUE  AND LOCASS.assessment_done  AND NOT LOCASS.cell_disapproved;","DROP RULE IF EXISTS LocationEvaluation_upd ON ""inbound"".""LocationEvaluation"";CREATE RULE LocationEvaluation_upd ASON UPDATE TO ""inbound"".""LocationEvaluation""DO INSTEAD UPDATE ""inbound"".""ExtraVisits"" SET  grouped_activity_id = NEW.grouped_activity_id,  teammember_id = NEW.teammember_id,  date_visit = NEW.date_visit,  type_assessed = NEW.type_assessed,  notes = NEW.notes,  photo = NEW.photo,  visit_done = NEW.visit_done WHERE extravisit_id = OLD.extravisit_id;","ward,karen,floris","ward,karen,floris",preliminary table to store field visit info by Ward,0
outbound,PriorVisits,"SELECT DISTINCT    iVIS.visit_id,    oCAL.wkb_geometry,    oCAL.fieldactivitycalendar_id,    mTEAM.username AS teammember,    CASE WHEN iVIS.type_assessed IS NULL     THEN (       CASE WHEN oCAL.type_adjusted IS NULL        THEN oCAL.type        ELSE oCAL.type_adjusted        END)     ELSE iVIS.type_assessed     END as type,    iVIS.date_visit,    mACT.activity_name,    iVIS.notes AS field_notesFROM ""inbound"".""Visits"" AS iVISLEFT JOIN ""outbound"".""fieldactivitycalendar"" AS oCAL ON iVIS.fieldactivitycalendar_id = oCAL.fieldactivitycalendar_idLEFT JOIN ""metadata"".""TeamMembers"" AS mTEAM ON iVIS.teammember_id = mTEAM.teammember_idLEFT JOIN ""metadata"".""GroupedActivities"" AS mACT ON mACT.grouped_activity_id = iVIS.grouped_activity_idWHERE iVIS.visit_done",,"ward,karen,floris",,aggregating prior visits for fieldwork preparation,1
inbound,VisitNotes,"SELECT    ivis.visit_id,    iVIS.fieldactivitycalendar_id,    mTEAM.username AS team_assigned,    iVIS.teammember_id,    CASE WHEN oCAL.type_adjusted IS NULL      THEN oCAL.type      ELSE oCAL.type_adjusted      END as type,    iVIS.type_assessed,    oCAL.notes AS preparation_notes,    oCAL.visit_date_planned,    iVIS.date_visit,    iVIS.visit_due,    iVIS.visit_overdue,    iVIS.activity_rank,    mACT.activity_group,    mACT.activity_name,    iVIS.notes AS field_notes,    iVIS.visit_done,    oCAL.wkb_geometryFROM ""inbound"".""Visits"" AS iVISLEFT JOIN ""outbound"".""fieldactivitycalendar"" AS oCAL ON iVIS.fieldactivitycalendar_id = oCAL.fieldactivitycalendar_idLEFT JOIN ""metadata"".""TeamMembers"" AS mTEAM ON oCAL.teammember_assigned = mTEAM.teammember_idLEFT JOIN ""metadata"".""GroupedActivities"" AS mACT ON mACT.grouped_activity_id = iVIS.grouped_activity_id","DROP RULE IF EXISTS VisitNotes_upd ON ""inbound"".""VisitNotes"";CREATE RULE VisitNotes_upd ASON UPDATE TO ""inbound"".""VisitNotes""DO INSTEAD UPDATE ""inbound"".""Visits"" SET teammember_id = NEW.teammember_id,     type_assessed = NEW.type_assessed,     date_visit = NEW.date_visit,     visit_due = NEW.visit_due,     visit_overdue = NEW.visit_overdue,     activity_rank = NEW.activity_rank,     notes = NEW.field_notes,     visit_done = NEW.visit_done WHERE fieldactivitycalendar_id = OLD.fieldactivitycalendar_id;","ward,karen,floris","ward,karen,floris",aggregate notes from prior visits,1
outbound,ReplacementProcessing,"SELECT *FROM ""outbound"".""ReplacementLocations"" AS oREPLWHERE oREPL.fieldactivitycalendar_id IN (  SELECT DISTINCT fieldactivitycalendar_id  FROM ""outbound"".""fieldactivitycalendar""  WHERE replacement_ongoing AND NOT is_replaced)",,"ward,karen,floris","ward,karen,floris",transient view to handle location replacement,1
