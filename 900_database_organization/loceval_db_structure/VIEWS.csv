schema,view,query,rules,SELECT,UPDATE,purpose,excluded
outbound,OrthophotoAssessment,"SELECT  LOC.*,  LOCASS.locationassessment_id,  (UNIT.location_id IS NULL) AS sample_location_obsolete,  UNIT.grts_join_method,  UNIT.sp_poststratum,  UNIT.scheme_ps_targetpanels,  UNIT.type,  UNIT.assessment,  UNIT.assessment_date,  LOCASS.cell_disapproved,  LOCASS.revisit_disapproval,  LOCASS.disapproval_explanation,  LOCASS.type_suggested,  LOCASS.implications_habitatmap,  LOCASS.feedback_habitatmap,  LOCASS.notes,  LOCASS.assessment_doneFROM ""outbound"".""LocationAssessments"" AS LOCASSLEFT JOIN ""metadata"".""Locations"" AS LOC  ON LOC.location_id = LOCASS.location_idLEFT JOIN ""outbound"".""SampleUnits"" AS UNIT  ON (LOCASS.type = UNIT.type     AND LOCASS.grts_address = UNIT.grts_address     );","DROP RULE IF EXISTS OrthophotoAssessment_upd ON ""outbound"".""OrthophotoAssessment"";CREATE RULE OrthophotoAssessment_upd ASON UPDATE TO ""outbound"".""OrthophotoAssessment""DO INSTEAD UPDATE ""outbound"".""LocationAssessments"" SET  type_suggested = NEW.type_suggested,  cell_disapproved = NEW.cell_disapproved,  revisit_disapproval = NEW.revisit_disapproval,  disapproval_explanation = NEW.disapproval_explanation,  implications_habitatmap = NEW.implications_habitatmap,  feedback_habitatmap = NEW.feedback_habitatmap,  notes = NEW.notes,  assessment_done = NEW.assessment_done WHERE locationassessment_id = OLD.locationassessment_id;","tom,ward,floris,karen,monkey","tom,ward,floris,karen","field preparation: combination of Locations, SampleUnits, and LocationAssessments,with the purpose of orthophoto (and other) assessments in praetorio",0
inbound,LocationEvaluation,"SELECT  LOC.*,  EVI.visit_id,  EVI.teammember_id,  EVI.date_visit,  EVI.type_assessed,  EVI.notes,  EVI.photo,  EVI.visit_done,  UNIT.sampleunit_id,  UNIT.grts_join_method,  UNIT.scheme,  UNIT.panel_set,  UNIT.targetpanel,  UNIT.scheme_ps_targetpanels,  UNIT.sp_poststratum,  UNIT.type,  UNIT.assessment,  UNIT.assessment_date,  UNIT.is_replaced,  UNIT.replacement_ongoing,  UNIT.replacement_reason,  UNIT.replacement_permanence,  LOCASS.assessment_done,  LOCASS.cell_disapproved,  LOCASS.notes AS location_assessment,  CASE WHEN (FAC.date_visit_planned IS NULL) THEN FALSE ELSE TRUE END AS is_scheduled,  FAC.teammember_assigned,  FAC.activity_group_id,  FAC.date_visit_planned,  FAC.date_visit_planned - current_date AS days_to_visit,  FAC.date_end - current_date AS days_to_deadline,  FAC.priority,  FAC.notes AS preparation_notesFROM ""inbound"".""Visits"" AS EVILEFT JOIN ""metadata"".""Locations"" AS LOC  ON LOC.location_id = EVI.location_idLEFT JOIN ""outbound"".""SampleUnits"" AS UNIT  ON EVI.sampleunit_id = UNIT.sampleunit_idLEFT JOIN (  SELECT    sampleunit_id,    activity_group_id,    date_start,    date_end,    priority,    landowner,    teammember_assigned,    date_visit_planned,    no_visit_planned,    notes  FROM ""outbound"".""FieldActivityCalendar"" AS CAL  ) AS FAC  ON (FAC.sampleunit_id = UNIT.sampleunit_id)LEFT JOIN (  SELECT DISTINCT    location_id,    cell_disapproved,    assessment_done,    notes  FROM ""outbound"".""LocationAssessments""  GROUP BY    location_id,    cell_disapproved,    assessment_done,    notes  ) AS LOCASS  ON EVI.location_id = LOCASS.location_idWHERE TRUE  AND ((LOCASS.cell_disapproved IS NULL) OR (NOT LOCASS.cell_disapproved))  AND ((FAC.no_visit_planned IS NULL) OR (NOT FAC.no_visit_planned));","DROP RULE IF EXISTS LocationEvaluation_upd0 ON ""inbound"".""LocationEvaluation"";CREATE RULE LocationEvaluation_upd0 ASON UPDATE TO ""inbound"".""LocationEvaluation""DO INSTEAD NOTHING;DROP RULE IF EXISTS LocationEvaluation_upd1 ON ""inbound"".""LocationEvaluation"";CREATE RULE LocationEvaluation_upd1 ASON UPDATE TO ""inbound"".""LocationEvaluation""DO ALSO UPDATE ""inbound"".""Visits"" SET  teammember_id = NEW.teammember_id,  date_visit = NEW.date_visit,  type_assessed = NEW.type_assessed,  notes = NEW.notes,  photo = NEW.photo,  visit_done = NEW.visit_done WHERE visit_id = OLD.visit_id;DROP RULE IF EXISTS LocationEvaluation_upd2 ON ""inbound"".""LocationEvaluation"";CREATE RULE LocationEvaluation_upd2 ASON UPDATE TO ""inbound"".""LocationEvaluation""DO ALSO UPDATE ""outbound"".""SampleUnits"" SET  is_replaced = NEW.is_replaced,  replacement_ongoing = NEW.replacement_ongoing,  replacement_reason = NEW.replacement_reason,  replacement_permanence = NEW.replacement_permanence WHERE sampleunit_id = OLD.sampleunit_id;","tom,ward,floris,karen,monkey","tom,ward,floris,karen",preliminary table to store field visit info by Ward,0
outbound,FieldworkPlanning,"SELECT  LOC.*,  FAC.fieldactivitycalendar_id,  FAC.sampleunit_id,  FAC.activity_group_id,  FAC.activity_group_id IN (    SELECT DISTINCT activity_group_id FROM ""metadata"".""GroupedActivities""    WHERE is_loceval_activity  ) AS is_loceval_activity,  FAC.activity_rank,  FAC.priority,  FAC.date_start,  FAC.date_end,  FAC.date_interval,  FAC.date_end - current_date AS days_to_deadline,  FAC.wait_watersurface,  FAC.wait_3260,  FAC.wait_7220,  (FAC.wait_watersurface OR FAC.wait_3260 OR FAC.wait_7220) AS is_waiting,  FAC.excluded,  FAC.excluded_reason,  FAC.landowner,  FAC.inaccessible,  FAC.acceccibility_revisit,  FAC.teammember_assigned,  FAC.date_visit_planned,  FAC.no_visit_planned,  FAC.notes,  FAC.done_planning,  UNIT.grts_join_method,  UNIT.scheme,  UNIT.panel_set,  UNIT.targetpanel,  UNIT.scheme_ps_targetpanels,  UNIT.sp_poststratum,  UNIT.type,  UNIT.assessment,  UNIT.assessment_date,  UNIT.previous_notes,  UNIT.is_replaced,  LOCASS.cell_disapproved,  LOCASS.assessment_doneFROM ""outbound"".""FieldActivityCalendar"" AS FACLEFT JOIN ""outbound"".""SampleUnits"" AS UNIT  ON FAC.sampleunit_id = UNIT.sampleunit_idLEFT JOIN ""metadata"".""Locations"" AS LOC  ON LOC.location_id = UNIT.location_idLEFT JOIN (  SELECT DISTINCT    location_id,    cell_disapproved,    assessment_done  FROM ""outbound"".""LocationAssessments""  GROUP BY    location_id,    cell_disapproved,    assessment_done  ) AS LOCASS  ON UNIT.location_id = LOCASS.location_idORDER BY  FAC.date_end,  FAC.priority,  is_waiting,  FAC.stratum,  FAC.grts_address,  FAC.activity_rank,  FAC.activity_group_id;","DROP RULE IF EXISTS FieldworkPlanning_upd ON ""outbound"".""FieldworkPlanning"";CREATE RULE FieldworkPlanning_upd ASON UPDATE TO ""outbound"".""FieldworkPlanning""DO INSTEAD UPDATE ""outbound"".""FieldActivityCalendar"" SET  excluded = NEW.excluded,  excluded_reason = NEW.excluded_reason,  landowner = NEW.landowner,  inaccessible = NEW.inaccessible,  acceccibility_revisit = NEW.acceccibility_revisit,  teammember_assigned = NEW.teammember_assigned,  date_visit_planned = NEW.date_visit_planned,  no_visit_planned = NEW.no_visit_planned,  notes = NEW.notes,  done_planning = NEW.done_planning WHERE fieldactivitycalendar_id = OLD.fieldactivitycalendar_id;","tom,ward,floris,karen,monkey","tom,ward,floris,karen",Fieldwork preparation for Ward,0
inbound,ReplacementOngoing,"SELECT  REPU.*,  VISIT.notes AS unit_notes,  VISIT.visit_id,  VISIT.type_assessed,  VISIT.visit_doneFROM (  SELECT    REP.ogc_fid,    REP.wkb_geometry,    REP.replacement_id,    UNIT.sampleunit_id,    REP.grts_address_replacement AS grts_address,    REP.replacement_rank,    REP.is_selected,    REP.is_inappropriate,    REP.implications_habitatmap,    UNIT.is_replaced,    REP.notes AS rep_notes  FROM ""outbound"".""Replacements"" AS REP  LEFT JOIN ""outbound"".""SampleUnits"" AS UNIT    ON UNIT.sampleunit_id = REP.sampleunit_id  WHERE UNIT.replacement_ongoing    AND NOT UNIT.is_replaced) AS REPULEFT JOIN ""inbound"".""Visits"" AS VISIT  ON REPU.sampleunit_id = VISIT.sampleunit_id;","DROP RULE IF EXISTS ReplacementOngoing_upd0 ON ""inbound"".""ReplacementOngoing"";CREATE RULE ReplacementOngoing_upd0 ASON UPDATE TO ""inbound"".""ReplacementOngoing""DO INSTEAD NOTHING;DROP RULE IF EXISTS ReplacementOngoing_upd1 ON ""inbound"".""ReplacementOngoing"";CREATE RULE ReplacementOngoing_upd1 ASON UPDATE TO ""inbound"".""ReplacementOngoing""DO ALSO UPDATE ""outbound"".""Replacements"" SET  is_selected = NEW.is_selected,  is_inappropriate = NEW.is_inappropriate,  implications_habitatmap = NEW.implications_habitatmap,  notes = NEW.rep_notes WHERE replacement_id = OLD.replacement_id;DROP RULE IF EXISTS ReplacementOngoing_upd2 ON ""inbound"".""ReplacementOngoing"";CREATE RULE ReplacementOngoing_upd2 ASON UPDATE TO ""inbound"".""ReplacementOngoing""DO ALSO UPDATE ""inbound"".""Visits"" SET  type_assessed = NEW.type_assessed,  notes = NEW.unit_notes,  visit_done = NEW.visit_done WHERE visit_id = OLD.visit_id;","tom,ward,floris,karen,monkey","tom,ward,floris,karen",live display of cells to replace,0
outbound,SampleCells,"SELECT *FROM ""metadata"".""LocationCells""WHERE location_id IN (  SELECT DISTINCT location_id  FROM ""outbound"".""SampleUnits"")UNIONSELECT *FROM ""outbound"".""ReplacementCells""WHERE replacement_id IN (  SELECT DISTINCT REP.replacement_id  FROM ""outbound"".""Replacements"" AS REP  LEFT JOIN ""outbound"".""SampleUnits"" AS UNIT    ON UNIT.sampleunit_id = REP.sampleunit_id  WHERE replacement_ongoing);",,"tom,ward,floris,karen,monkey","tom,ward,floris,karen",Show grts cells of sample locations AND selected replacement cells,0
outbound,SamplePolygons,"SELECT DISTINCT POL.ogc_fid, POL.wkb_geometry, UNIT.type, UNIT.replacement_ongoing, UNIT.is_replacedFROM ""outbound"".""SampleUnitPolygons"" AS POLLEFT JOIN ""outbound"".""SampleUnits"" AS UNIT  ON UNIT.sampleunit_id = POL.sampleunit_id;",,"tom,ward,floris,karen,monkey","tom,ward,floris,karen","Show polygons of sample units, with indication of ongoing replacement",
