schema,view,query,rules,SELECT,UPDATE,purpose,excluded
outbound,OrthophotoAssessment,"SELECT  LOC.*,  LOCASS.locationassessment_id,  (UNIT.location_id IS NULL) AS sample_location_obsolete,  UNIT.grts_join_method,  UNIT.sp_poststratum,  UNIT.scheme_ps_targetpanels,  UNIT.assessment,  UNIT.assessment_date,  LOCASS.type,  LOCASS.cell_disapproved,  LOCASS.revisit_disapproval,  LOCASS.disapproval_explanation,  LOCASS.type_suggested,  LOCASS.implications_habitatmap,  LOCASS.feedback_habitatmap,  LOCASS.notes,  LOCASS.assessment_doneFROM ""outbound"".""LocationAssessments"" AS LOCASSLEFT JOIN ""metadata"".""Locations"" AS LOC  ON LOC.location_id = LOCASS.location_idLEFT JOIN ""outbound"".""SampleUnits"" AS UNIT  ON (LOCASS.grts_address = UNIT.grts_address  -- AND LOCASS.type = UNIT.type     )  WHERE UNIT.location_id IS NOT NULL;","DROP RULE IF EXISTS OrthophotoAssessment_upd ON ""outbound"".""OrthophotoAssessment"";CREATE RULE OrthophotoAssessment_upd ASON UPDATE TO ""outbound"".""OrthophotoAssessment""DO INSTEAD UPDATE ""outbound"".""LocationAssessments"" SET  type_suggested = NEW.type_suggested,  cell_disapproved = NEW.cell_disapproved,  revisit_disapproval = NEW.revisit_disapproval,  disapproval_explanation = NEW.disapproval_explanation,  implications_habitatmap = NEW.implications_habitatmap,  feedback_habitatmap = NEW.feedback_habitatmap,  notes = NEW.notes,  assessment_done = NEW.assessment_done WHERE locationassessment_id = OLD.locationassessment_id;","tom,ward,floris,karen,monkey","tom,ward,floris,karen","field preparation: combination of Locations, SampleUnits, and LocationAssessments,with the purpose of orthophoto (and other) assessments in praetorio",0
inbound,LocationEvaluation,"SELECT  LOC.*,  VISIT.visit_id,  VISIT.teammember_id,  VISIT.date_visit,  VISIT.type_assessed,  VISIT.notes,  VISIT.photo,  VISIT.visit_done,  UNIT.sampleunit_id,  UNIT.grts_join_method,  UNIT.scheme,  UNIT.panel_set,  UNIT.targetpanel,  UNIT.scheme_ps_targetpanels,  UNIT.sp_poststratum,  UNIT.type,  UNIT.assessment,  UNIT.assessment_date,  UNIT.is_replaced,  UNIT.replacement_ongoing,  UNIT.replacement_reason,  UNIT.replacement_permanence,  INFO.locationinfo_id,  INFO.recovery_hints,  INFO.landowner,  INFO.accessibility_inaccessible,  INFO.accessibility_revisit,  LOCASS.assessment_done,  LOCASS.cell_disapproved,  LOCASS.notes AS location_assessment,  CASE WHEN (FAC.date_visit_planned IS NULL) THEN FALSE ELSE TRUE END AS is_scheduled,  FAC.teammember_assigned,  FAC.activity_group_id,  FAC.date_visit_planned,  FAC.date_visit_planned - current_date AS days_to_visit,  FAC.date_end - current_date AS days_to_deadline,  FAC.priority,  FAC.notes AS preparation_notesFROM ""inbound"".""Visits"" AS VISITLEFT JOIN ""metadata"".""Locations"" AS LOC  ON LOC.location_id = VISIT.location_idLEFT JOIN ""outbound"".""LocationInfos"" AS INFO  ON INFO.location_id = VISIT.location_idLEFT JOIN ""outbound"".""SampleUnits"" AS UNIT  ON VISIT.sampleunit_id = UNIT.sampleunit_idLEFT JOIN (  SELECT    sampleunit_id,    activity_group_id,    date_start,    date_end,    priority,    teammember_assigned,    date_visit_planned,    no_visit_planned,    notes  FROM ""outbound"".""FieldActivityCalendar"" AS CAL  ) AS FAC  ON (FAC.sampleunit_id = UNIT.sampleunit_id)LEFT JOIN (  SELECT DISTINCT    location_id,    cell_disapproved,    assessment_done,    notes  FROM ""outbound"".""LocationAssessments""  GROUP BY    location_id,    cell_disapproved,    assessment_done,    notes  ) AS LOCASS  ON VISIT.location_id = LOCASS.location_idWHERE TRUE  AND ((LOCASS.cell_disapproved IS NULL) OR (NOT LOCASS.cell_disapproved))  AND ((FAC.no_visit_planned IS NULL) OR (NOT FAC.no_visit_planned))  AND (FAC.activity_group_id IN  (SELECT DISTINCT activity_group_id FROM ""metadata"".""GroupedActivities""  WHERE is_loceval_activity)  );","DROP RULE IF EXISTS LocationEvaluation_upd0 ON ""inbound"".""LocationEvaluation"";CREATE RULE LocationEvaluation_upd0 ASON UPDATE TO ""inbound"".""LocationEvaluation""DO INSTEAD NOTHING;DROP RULE IF EXISTS LocationEvaluation_upd1 ON ""inbound"".""LocationEvaluation"";CREATE RULE LocationEvaluation_upd1 ASON UPDATE TO ""inbound"".""LocationEvaluation""DO ALSO UPDATE ""inbound"".""Visits"" SET  teammember_id = NEW.teammember_id,  date_visit = NEW.date_visit,  type_assessed = NEW.type_assessed,  notes = NEW.notes,  photo = NEW.photo,  visit_done = NEW.visit_done WHERE visit_id = OLD.visit_id;DROP RULE IF EXISTS LocationEvaluation_upd2 ON ""inbound"".""LocationEvaluation"";CREATE RULE LocationEvaluation_upd2 ASON UPDATE TO ""inbound"".""LocationEvaluation""DO ALSO UPDATE ""outbound"".""SampleUnits"" SET  is_replaced = NEW.is_replaced,  replacement_ongoing = NEW.replacement_ongoing,  replacement_reason = NEW.replacement_reason,  replacement_permanence = NEW.replacement_permanence WHERE sampleunit_id = OLD.sampleunit_id;DROP RULE IF EXISTS LocationEvaluation_upd3 ON ""inbound"".""LocationEvaluation"";CREATE RULE LocationEvaluation_upd3 ASON UPDATE TO ""inbound"".""LocationEvaluation""DO ALSO UPDATE ""outbound"".""LocationInfos"" SET  recovery_hints = NEW.recovery_hints,  accessibility_inaccessible = NEW.accessibility_inaccessible,  accessibility_revisit = NEW.accessibility_revisit WHERE locationinfo_id = OLD.locationinfo_id;","tom,ward,floris,karen,monkey","tom,ward,floris,karen",preliminary table to store field visit info by Ward,0
outbound,FieldworkPlanning,"SELECT  LOC.*,  FAC.fieldactivitycalendar_id,  FAC.sampleunit_id,  FAC.activity_group_id,  FAC.activity_group_id IN (    SELECT DISTINCT activity_group_id FROM ""metadata"".""GroupedActivities""    WHERE is_loceval_activity  ) AS is_loceval_activity,  FAC.activity_rank,  FAC.priority,  FAC.date_start,  FAC.date_end,  FAC.date_interval,  FAC.date_end - current_date AS days_to_deadline,  FAC.wait_watersurface,  FAC.wait_3260,  FAC.wait_7220,  (FAC.wait_watersurface OR FAC.wait_3260 OR FAC.wait_7220) AS is_waiting,  FAC.excluded,  FAC.excluded_reason,  INFO.landowner,  FAC.teammember_assigned,  FAC.date_visit_planned,  FAC.no_visit_planned,  FAC.notes,  FAC.done_planning,  UNIT.grts_join_method,  UNIT.scheme,  UNIT.panel_set,  UNIT.targetpanel,  UNIT.scheme_ps_targetpanels,  UNIT.sp_poststratum,  UNIT.type,  UNIT.assessment,  UNIT.assessment_date,  UNIT.previous_notes,  INFO.locationinfo_id,  INFO.accessibility_inaccessible,  INFO.accessibility_revisit,  INFO.recovery_hints,  UNIT.is_replaced,  LOCASS.cell_disapproved,  LOCASS.assessment_doneFROM ""outbound"".""FieldActivityCalendar"" AS FACLEFT JOIN ""outbound"".""SampleUnits"" AS UNIT  ON FAC.sampleunit_id = UNIT.sampleunit_idLEFT JOIN ""metadata"".""Locations"" AS LOC  ON LOC.location_id = UNIT.location_idLEFT JOIN ""outbound"".""LocationInfos"" AS INFO  ON INFO.location_id = UNIT.location_idLEFT JOIN (  SELECT DISTINCT    location_id,    cell_disapproved,    assessment_done  FROM ""outbound"".""LocationAssessments""  GROUP BY    location_id,    cell_disapproved,    assessment_done  ) AS LOCASS  ON UNIT.location_id = LOCASS.location_idORDER BY  FAC.date_end,  FAC.priority,  is_waiting,  FAC.stratum,  FAC.grts_address,  FAC.activity_rank,  FAC.activity_group_id;","DROP RULE IF EXISTS FieldworkPlanning_upd0 ON ""outbound"".""FieldworkPlanning"";CREATE RULE FieldworkPlanning_upd0 ASON UPDATE TO ""outbound"".""FieldworkPlanning""DO INSTEAD NOTHING;DROP RULE IF EXISTS FieldworkPlanning_upd1 ON ""outbound"".""FieldworkPlanning"";CREATE RULE FieldworkPlanning_upd1 ASON UPDATE TO ""outbound"".""FieldworkPlanning""DO ALSO UPDATE ""outbound"".""FieldActivityCalendar"" SET  excluded = NEW.excluded,  excluded_reason = NEW.excluded_reason,  teammember_assigned = NEW.teammember_assigned,  date_visit_planned = NEW.date_visit_planned,  no_visit_planned = NEW.no_visit_planned,  notes = NEW.notes,  done_planning = NEW.done_planning WHERE fieldactivitycalendar_id = OLD.fieldactivitycalendar_id;DROP RULE IF EXISTS FieldworkPlanning_upd2 ON ""outbound"".""FieldworkPlanning"";CREATE RULE FieldworkPlanning_upd2 ASON UPDATE TO ""outbound"".""FieldworkPlanning""DO ALSO UPDATE ""outbound"".""LocationInfos"" SET  accessibility_inaccessible = NEW.accessibility_inaccessible,  accessibility_revisit = NEW.accessibility_revisit,  landowner = NEW.landowner,  recovery_hints = NEW.recovery_hints WHERE locationinfo_id = OLD.locationinfo_id;","tom,ward,floris,karen,monkey","tom,ward,floris,karen",Fieldwork preparation for Ward,0
inbound,ReplacementOngoing,"SELECT  REPU.*,  VISIT.notes AS unit_notes,  VISIT.visit_id,  VISIT.type_assessed,  VISIT.photo,  VISIT.visit_doneFROM (  SELECT    REP.ogc_fid,    REP.wkb_geometry,    REP.replacement_id,    UNIT.location_id,    UNIT.sampleunit_id,    REP.grts_address_replacement AS grts_address,    REP.replacement_rank,    REP.is_selected,    REP.is_inappropriate,    REP.implications_habitatmap,    UNIT.is_replaced,    REP.notes AS rep_notes,    INFO.locationinfo_id,    INFO.accessibility_inaccessible,    INFO.accessibility_revisit,    INFO.recovery_hints  FROM ""outbound"".""Replacements"" AS REP  LEFT JOIN ""outbound"".""SampleUnits"" AS UNIT    ON UNIT.sampleunit_id = REP.sampleunit_id  LEFT JOIN ""outbound"".""LocationInfos"" AS INFO   ON UNIT.location_id = INFO.location_id  WHERE UNIT.replacement_ongoing    AND (NOT UNIT.is_replaced OR REP.is_selected)) AS REPULEFT JOIN ""inbound"".""Visits"" AS VISIT  ON REPU.sampleunit_id = VISIT.sampleunit_id;","DROP RULE IF EXISTS ReplacementOngoing_upd0 ON ""inbound"".""ReplacementOngoing"";CREATE RULE ReplacementOngoing_upd0 ASON UPDATE TO ""inbound"".""ReplacementOngoing""DO INSTEAD NOTHING;DROP RULE IF EXISTS ReplacementOngoing_upd1 ON ""inbound"".""ReplacementOngoing"";CREATE RULE ReplacementOngoing_upd1 ASON UPDATE TO ""inbound"".""ReplacementOngoing""DO ALSO UPDATE ""outbound"".""Replacements"" SET  is_selected = NEW.is_selected,  is_inappropriate = NEW.is_inappropriate,  implications_habitatmap = NEW.implications_habitatmap,  notes = NEW.rep_notes WHERE replacement_id = OLD.replacement_id;DROP RULE IF EXISTS ReplacementOngoing_upd4 ON ""inbound"".""ReplacementOngoing"";CREATE RULE ReplacementOngoing_upd4 ASON UPDATE TO ""inbound"".""ReplacementOngoing""DO ALSO UPDATE ""outbound"".""LocationInfos"" SET  accessibility_inaccessible = NEW.accessibility_inaccessible,  accessibility_revisit = NEW.accessibility_revisit,  recovery_hints = NEW.recovery_hints WHERE locationinfo_id = OLD.locationinfo_id;DROP RULE IF EXISTS ReplacementOngoing_upd3 ON ""inbound"".""ReplacementOngoing"";CREATE RULE ReplacementOngoing_upd3 ASON UPDATE TO ""inbound"".""ReplacementOngoing""DO ALSO UPDATE ""outbound"".""SampleUnits"" SET  is_replaced = NEW.is_replaced WHERE sampleunit_id = OLD.sampleunit_id;DROP RULE IF EXISTS ReplacementOngoing_upd2 ON ""inbound"".""ReplacementOngoing"";CREATE RULE ReplacementOngoing_upd2 ASON UPDATE TO ""inbound"".""ReplacementOngoing""DO ALSO UPDATE ""inbound"".""Visits"" SET  type_assessed = NEW.type_assessed,  notes = NEW.unit_notes,  photo = NEW.photo,  visit_done = NEW.visit_done WHERE visit_id = OLD.visit_id;","tom,ward,floris,karen,monkey","tom,ward,floris,karen",live display of cells to replace,0
outbound,SampleCells,"SELECT DISTINCT ON (location_id) *FROM (SELECT *FROM ""metadata"".""LocationCells""WHERE location_id IN (  SELECT DISTINCT location_id  FROM ""outbound"".""SampleUnits"")UNIONSELECT *FROM ""outbound"".""ReplacementCells""WHERE replacement_id IN (  SELECT DISTINCT REP.replacement_id  FROM ""outbound"".""Replacements"" AS REP  LEFT JOIN ""outbound"".""SampleUnits"" AS UNIT    ON UNIT.sampleunit_id = REP.sampleunit_id  WHERE replacement_ongoing    AND (NOT UNIT.is_replaced OR REP.is_selected)))GROUP BY ogc_fid, wkb_geometry, location_idORDER BY location_id;",,"tom,ward,floris,karen,monkey","tom,ward,floris,karen",Show grts cells of sample locations AND selected replacement cells,0
outbound,SamplePolygons,"SELECT DISTINCT POL.ogc_fid, POL.wkb_geometry, UNIT.type, UNIT.replacement_ongoing, UNIT.is_replacedFROM ""outbound"".""SampleUnitPolygons"" AS POLLEFT JOIN ""outbound"".""SampleUnits"" AS UNIT  ON UNIT.sampleunit_id = POL.sampleunit_id;",,"tom,ward,floris,karen,monkey","tom,ward,floris,karen","Show polygons of sample units, with indication of ongoing replacement",
outbound,gwTransfer,"SELECT  VISIT.log_user,  VISIT.log_update,  UNIT.scheme,  UNIT.panel_set,  UNIT.targetpanel,  UNIT.type,  UNIT.grts_address AS grts_address_original,  CASE WHEN LOREP.grts_address_replacement IS NULL    THEN UNIT.grts_address    ELSE LOREP.grts_address_replacement    END AS grts_address,  VISIT.type_assessed,  'loceval' AS eval_source,  LOWER(TEAM.username) AS eval_name,  VISIT.date_visit AS eval_date,  VISIT.visit_id AS eval_id,  VISIT.notes || '|' || LOREP.replacement_notes AS notes,  VISIT.photoFROM ""inbound"".""Visits"" AS VISITLEFT JOIN ""outbound"".""SampleUnits"" AS UNIT  ON VISIT.sampleunit_id = UNIT.sampleunit_idLEFT JOIN ""metadata"".""TeamMembers"" AS TEAM  ON TEAM.teammember_id = VISIT.teammember_idLEFT JOIN (  SELECT    sampleunit_id,    grts_address_replacement,    notes AS replacement_notes  FROM ""outbound"".""Replacements""  WHERE is_selected  ) AS LOREP  ON UNIT.sampleunit_id = LOREP.sampleunit_idWHERE TRUE  AND (VISIT.visit_done)UNIONSELECT  LOCASS.log_user,  LOCASS.log_update,  UNIT.scheme,  UNIT.panel_set,  UNIT.targetpanel,  UNIT.type,  UNIT.grts_address AS grts_address_original,  CASE WHEN LOREP.grts_address_replacement IS NULL    THEN UNIT.grts_address    ELSE LOREP.grts_address_replacement    END AS grts_address,  LOCASS.type_suggested AS type_assessed,  'orthophotos' AS eval_source,  LOWER(LOCASS.log_user) AS eval_name,  CAST(LOCASS.log_update AS DATE) AS eval_date,  LOCASS.locationassessment_id AS eval_id,  LOCASS.notes,  NULL AS photoFROM ""outbound"".""LocationAssessments"" AS LOCASSLEFT JOIN ""outbound"".""SampleUnits"" AS UNIT  ON (LOCASS.grts_address = UNIT.grts_address     AND LOCASS.type = UNIT.type)LEFT JOIN (  SELECT    sampleunit_id,    grts_address_replacement,    notes AS replacement_notes  FROM ""outbound"".""Replacements""  WHERE is_selected  ) AS LOREP  ON UNIT.sampleunit_id = LOREP.sampleunit_idWHERE TRUE  AND (LOCASS.assessment_done)  AND (UNIT.location_id IS NOT NULL);",,monkey,,information transfer to mnmgwdb,0
outbound,LocationCoords,"SELECT  LOC.*,  COORDS.coordinate_id,  COORDS.wgs84_x,  COORDS.wgs84_y,  COORDS.lambert_x,  COORDS.lambert_y,  '<a href=""https://www.google.com/maps/place/' ||    CAST(COORDS.wgs84_y AS VARCHAR) ||    ',' ||    CAST(COORDS.wgs84_x AS VARCHAR) ||    '""> google </a>, <br><br> ' ||  '<a href=""https://www.openstreetmap.org/?mlat=' ||    CAST(COORDS.wgs84_y AS VARCHAR) ||    '&mlon=' ||    CAST(COORDS.wgs84_x AS VARCHAR) ||    '""> openstreetmap </a>, <br><br> ' ||  '<a href=""https://waze.com/ul?ll=' ||    CAST(COORDS.wgs84_y AS VARCHAR) ||    ',' ||    CAST(COORDS.wgs84_x AS VARCHAR) ||    '""> waze </a>'    AS google_linkFROM ""metadata"".""Locations"" AS LOCLEFT JOIN ""metadata"".""Coordinates"" AS COORDS  ON COORDS.location_id = LOC.location_idWHERE LOC.location_id IS NOT NULL  AND COORDS.location_id IS NOT NULL;",,"tom,ward,floris,karen,monkey",,coordinates in BD72 and WGS84 for car navigation,0
outbound,MHQSafety,"SELECT *FROM ""outbound"".""MHQPolygons""WHERE sampleunit_id IN (    SELECT DISTINCT sampleunit_id    FROM ""inbound"".""Visits""  );",,"tom,ward,floris,karen,monkey",,MHQ safety polygon,0
