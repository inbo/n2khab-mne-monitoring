sql,deactivated
"ALTER TABLE ""metadata"".""GroupedActivities"" ADD CONSTRAINT uq_activities UNIQUE (activity_group, activity);",
BEGIN;COMMIT;,"-- ALTER TABLE ""outbound"".""fieldactivitycalendar"" ADD CONSTRAINT check_loccal_activity_groups CHECK ( activity_group_id IN (SELECT DISTINCT activity_group_id FROM ""metadata"".""GroupedActivities"" GROUP BY activity_group_id )); -- not possible :("
"DROP FUNCTION IF EXISTS sync_mod CASCADE;CREATE FUNCTION sync_mod() RETURNS trigger AS $sync_mod$BEGIN  NEW.log_update := current_timestamp;  NEW.log_user := current_user;  RETURN NEW  ;END;$sync_mod$ LANGUAGE plpgsql;DROP TRIGGER IF EXISTS log_assessments ON ""outbound"".""LocationAssessments"";CREATE TRIGGER log_assessmentsBEFORE UPDATE ON ""outbound"".""LocationAssessments""FOR EACH ROW EXECUTE PROCEDURE sync_mod();DROP TRIGGER IF EXISTS log_fieldactivitycalendar ON ""outbound"".""FieldActivityCalendar"";CREATE TRIGGER log_fieldactivitycalendarBEFORE UPDATE ON ""outbound"".""FieldActivityCalendar""FOR EACH ROW EXECUTE PROCEDURE sync_mod();DROP TRIGGER IF EXISTS log_freefieldnotes ON ""inbound"".""FreeFieldNotes"";CREATE TRIGGER log_freefieldnotesBEFORE UPDATE ON ""inbound"".""FreeFieldNotes""FOR EACH ROW EXECUTE PROCEDURE sync_mod();DROP TRIGGER IF EXISTS log_extravisits ON ""inbound"".""ExtraVisits"";CREATE TRIGGER log_extravisitsBEFORE UPDATE ON ""inbound"".""ExtraVisits""FOR EACH ROW EXECUTE PROCEDURE sync_mod();",-- update triggers to log user and modification time
"ALTER TABLE ""metadata"".""LocationCells"" DROP CONSTRAINT IF EXISTS fk_Locations_LocationCells CASCADE;ALTER TABLE ""metadata"".""LocationCells"" ADD CONSTRAINT fk_Locations_LocationCells FOREIGN KEY (location_id)REFERENCES ""metadata"".""Locations"" (location_id) MATCH SIMPLEON DELETE CASCADE ON UPDATE CASCADE;",-- location_cells must delete on locations cascade (non-null constraint for foreign key is difficult)
