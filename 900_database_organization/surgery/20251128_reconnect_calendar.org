#+title: Reconnect Calendar
#+date: 20251128

* =lims_code= in ="inbound"."Visits"=


#+begin_src sql
SELECT DISTINCT lims_code FROM "inbound"."Visits";

-- ALTER TABLE "inbound"."Visits" DROP COLUMN lims_code;

#+end_src

gone.


* chasing calendar zombies


https://docs.google.com/document/d/1w3PBfuVSOJkWZ5zgh62iHSnfYd1icfOQ0wmV_62dxl4/edit?tab=t.0


#+begin_src sql
SELECT *
FROM "inbound"."Visits"
WHERE TRUE
AND grts_address IN (1902553)
ORDER BY visit_done, activity_group_id
;
#+end_src

#+begin_src sql
\COPY (
SELECT DISTINCT
  grts_address,
  stratum,
  activity_group_id,
  date_start,
  archive_version_id,
  visit_done,
  (
    (teammember_id IS NOT NULL) OR
    (date_visit IS NOT NULL) OR
    (notes IS NOT NULL) OR
    (photo IS NOT NULL) OR
    (issues) OR
    (visit_done)
  ) AS was_modified,
  COUNT(*) AS n
  FROM "inbound"."Visits"
  WHERE grts_address IN (

   SELECT DISTINCT
    grts_address
   FROM (
    SELECT DISTINCT
    grts_address,
    stratum,
    activity_group_id,
    archive_version_id,
    (
      (teammember_id IS NOT NULL) OR
      (date_visit IS NOT NULL) OR
      (notes IS NOT NULL) OR
      (photo IS NOT NULL) OR
      (issues) OR
      (visit_done)
    ) AS was_modified,
    COUNT(*) AS duples
    FROM "inbound"."Visits"
    GROUP BY
    grts_address,
    stratum,
    activity_group_id,
    archive_version_id,
    was_modified
    )
    WHERE was_modified

  )
  GROUP BY
    grts_address,
    stratum,
    activity_group_id,
    date_start,
    archive_version_id,
    visit_done,
    was_modified
  ORDER BY
    grts_address,
    stratum,
    activity_group_id,
    date_start,
    was_modified
) TO '/data/mnm_db_backups/archive_zombies_20251128.csv' With CSV DELIMITER ',' HEADER
;

#+end_src

60185305, 23257
211193
6417454, 1999406
88274
236530
1736754
9262
27584145


???
1902553	9130_end
3202741	1310_pol


** excel sorting

** testing

SELECT
  fieldworkcalendar_id,
  (NOT excluded),
  (excluded_reason IS NULL),
  (teammember_assigned IS NULL),
  (date_visit_planned IS NULL),
  (NOT no_visit_planned),
  (notes IS NULL),
  (NOT done_planning)
FROM "outbound"."FieldworkCalendar"
WHERE
  grts_address = 9262
  AND stratum = '9120'
  AND activity_group_id = 4
;


SELECT
    grts_address,
    stratum,
    activity_group_id,
    date_start,
    VIS.fieldworkcalendar_id,
    visit_id
FROM "inbound"."Visits" AS VIS
LEFT JOIN (
  SELECT fieldworkcalendar_id, TRUE AS unmodified2
  FROM "outbound"."FieldworkCalendar"
  WHERE (
     (NOT excluded)
     AND (excluded_reason IS NULL)
     AND (teammember_assigned IS NULL)
     AND (date_visit_planned IS NULL)
     AND (NOT no_visit_planned)
     AND (notes IS NULL)
     AND (NOT done_planning)
  )
) AS FWC
  ON FWC.fieldworkcalendar_id = VIS.fieldworkcalendar_id
WHERE
  grts_address = 9262
  AND stratum = '9120'
  AND activity_group_id = 4
  AND NOT (
    (teammember_id IS NOT NULL) OR
    (date_visit IS NOT NULL) OR
    (notes IS NOT NULL) OR
    (photo IS NOT NULL) OR
    (issues) OR
    (visit_done)
  )
  AND unmodified2
;



SELECT *
FROM "outbound"."FieldworkCalendar"
WHERE TRUE
  AND grts_address = 60185305
  AND stratum = '91E0_va'
  AND activity_group_id = 4

         9262 | 9120    |                 4 | 2025-10-01 |                   57 |       57
         9262 | 9120    |                 9 | 2026-04-01 |                   59 |       59
         9262 | 9120    |                 9 | 2026-10-01 |                   60 |       60
         9262 | 9120    |                28 | 2025-10-01 |                   63 |       63
        23238 | 9160    |                 4 | 2026-01-01 |                  234 |      234
        23238 | 9160    |                 9 | 2025-10-01 |                  235 |      235
        23238 | 9160    |                 9 | 2026-07-01 |                  236 |      236
        23238 | 9160    |                28 | 2026-01-01 |                  238 |      238
        88274 | 9190    |                 4 | 2025-10-01 |                  710 |      710
        88274 | 9190    |                 9 | 2026-04-01 |                  712 |      712
        88274 | 9190    |                 9 | 2026-07-01 |                  713 |      713
        88274 | 9190    |                28 | 2025-10-01 |                  716 |      716
       105458 | 4010    |                 9 | 2026-01-01 |                  792 |      792
       105458 | 4010    |                 9 | 2026-10-01 |                  793 |      793
       105458 | 4010    |                28 | 2025-07-01 |                  796 |      796
       176862 | 4010    |                 4 | 2026-04-01 |                  991 |      991
       176862 | 4010    |                28 | 2026-04-01 |                  994 |      994
       198137 | 91E0_vc |                 4 | 2026-07-01 |                 1059 |     1059
       198137 | 91E0_vc |                28 | 2026-07-01 |                 1064 |     1064
       211193 | 91E0_vc |                 4 | 2026-04-01 |                 1077 |     1077
       211193 | 91E0_vc |                28 | 2026-04-01 |                 1080 |     1080
       236530 | 4010    |                 4 | 2026-04-01 |                 1118 |     1118
       292585 | 91E0_sf |                 4 | 2026-07-01 |                 1179 |     1179
       292585 | 91E0_sf |                28 | 2026-07-01 |                 1184 |     1184
       299701 | 1330_hpr |                 4 | 2026-01-01 |                 1186 |     1186
       299701 | 1330_hpr |                 9 | 2024-01-01 |                 1188 |     1188
       299701 | 1330_hpr |                 9 | 2026-07-01 |                 1187 |     1187
       299701 | 1330_hpr |                28 | 2024-01-01 |                 1192 |     1192
       369974 | 7140_meso |                 9 | 2026-01-01 |                 1292 |     1292
       369974 | 7140_meso |                 9 | 2026-07-01 |                 1293 |     1293
       450229 | 1330_hpr |                 4 | 2026-07-01 |                 1350 |     1350
       450229 | 1330_hpr |                28 | 2026-07-01 |                 1356 |     1356
       500782 | 6230_hmo |                 9 | 2026-01-01 |                 1404 |     1404
       500782 | 6230_hmo |                 9 | 2026-07-01 |                 1405 |     1405
       656798 | 6410_mo |                 4 | 2025-07-01 |                 1523 |     1523
       656798 | 6410_mo |                 9 | 2025-10-01 |                 1525 |     1525
       656798 | 6410_mo |                 9 | 2026-04-01 |                 1526 |     1526
       656798 | 6410_mo |                 9 | 2026-10-01 |                 1527 |     1527
       656798 | 6410_mo |                28 | 2025-07-01 |                 1530 |     1530
       696182 | 7140_meso |                 4 | 2026-01-01 |                 1582 |     1582
       696182 | 7140_meso |                28 | 2026-01-01 |                 1585 |     1585
       743982 | 6230_hmo |                 9 | 2026-01-01 |                 1651 |     1651
       743982 | 6230_hmo |                 9 | 2026-07-01 |                 1652 |     1652
       780114 | 6230_hmo |                 9 | 2026-04-01 |                 1697 |     1697
       780114 | 6230_hmo |                 9 | 2026-07-01 |                 1698 |     1698
       871030 | 7150    |                 4 | 2026-04-01 |                 1774 |     1774
       871030 | 7150    |                28 | 2026-04-01 |                 1780 |     1780
       979286 | 6230_hmo |                 4 | 2026-04-01 |                 1871 |     1871
       979286 | 6230_hmo |                28 | 2026-04-01 |                 1874 |     1874
      1736754 | 9160    |                 4 | 2025-07-01 |                 2243 |     2243
      1736754 | 9160    |                 9 | 2025-10-01 |                 2245 |     2245
      1736754 | 9160    |                 9 | 2026-07-01 |                 2246 |     2246
      1736754 | 9160    |                28 | 2025-07-01 |                 2249 |     2249
      1818369 | 6230_hmo |                 9 | 2026-04-01 |                 2298 |     2298
      1818369 | 6230_hmo |                 9 | 2026-10-01 |                 2299 |     2299
      1902553 | 9130_end |                 9 | 2026-01-01 |                 2342 |     2342
      1902553 | 9130_end |                 9 | 2026-04-01 |                 2343 |     2343
      1902553 | 9130_end |                 9 | 2026-10-01 |                 2344 |     2344
      1902553 | 9130_end |                11 | 2025-07-01 |                 2345 |     2345
      1902553 | 9130_end |                13 | 2025-07-01 |                 2347 |     2347
      1904953 | 9130_end |                 4 | 2025-10-01 |                 2351 |     2351
      1904953 | 9130_end |                 9 | 2026-04-01 |                 2353 |     2353
      1904953 | 9130_end |                 9 | 2026-07-01 |                 2354 |     2354
      1904953 | 9130_end |                28 | 2025-10-01 |                 2357 |     2357
      2227625 | 91E0_sf |                 9 | 2026-04-01 |                 4419 |     4419
      2227625 | 91E0_sf |                 9 | 2026-10-01 |                 4420 |     4420
      3202741 | 1310_pol |                 4 | 2026-04-01 |                 2594 |     2594
      3202741 | 1310_pol |                 9 | 2026-01-01 |                 2595 |     2595
      3202741 | 1310_pol |                 9 | 2026-07-01 |                 2596 |     2596
      3202741 | 1310_pol |                 9 | 2026-10-01 |                 2597 |     2597
      3202741 | 1310_pol |                28 | 2026-04-01 |                 2599 |     2599
      3664630 | 7140_meso |                 4 | 2025-07-01 |                 2671 |     2671
      3664630 | 7140_meso |                 9 | 2026-01-01 |                 2673 |     2673
      3664630 | 7140_meso |                 9 | 2026-04-01 |                 2674 |     2674
      3664630 | 7140_meso |                 9 | 2026-10-01 |                 2675 |     2675
      3664630 | 7140_meso |                11 | 2025-07-01 |                 2676 |     2676
      3664630 | 7140_meso |                11 | 2025-10-01 |                 2677 |     2677
      3664630 | 7140_meso |                13 | 2025-07-01 |                 2678 |     2678
      3664630 | 7140_meso |                13 | 2025-10-01 |                 2679 |     2679
      3664630 | 7140_meso |                28 | 2025-07-01 |                 2680 |     2680
      4241542 | 91E0_vm |                 4 | 2026-04-01 |                 2829 |     2829
      4241542 | 91E0_vm |                28 | 2026-04-01 |                 2832 |     2832
      4447925 | 1330_hpr |                 4 | 2025-10-01 |                 2915 |     2915
      4447925 | 1330_hpr |                28 | 2025-10-01 |                 2922 |     2922
      6092977 | 2190_mp |                 4 | 2026-07-01 |                 3030 |     3030
      6092977 | 2190_mp |                28 | 2026-07-01 |                 3036 |     3036
      6314694 | 91E0_va |                 4 | 2025-10-01 |                 3038 |     3038
      6314694 | 91E0_va |                 4 | 2026-07-01 |                 3039 |     3039
      6314694 | 91E0_va |                28 | 2025-10-01 |                 3044 |     3044
      6314694 | 91E0_va |                28 | 2026-07-01 |                 3045 |     3045
      6417454 | 91E0_vm |                 4 | 2025-10-01 |                 3050 |     3050
      6417454 | 91E0_vm |                 9 | 2026-04-01 |                 3052 |     3052
      6417454 | 91E0_vm |                 9 | 2026-07-01 |                 3053 |     3053
      6417454 | 91E0_vm |                28 | 2025-10-01 |                 3056 |     3056
      8826293 | 1330_hpr |                 9 | 2026-01-01 |                 3142 |     3142
      8826293 | 1330_hpr |                 9 | 2026-07-01 |                 3143 |     3143
      8826293 | 1330_hpr |                 9 | 2026-10-01 |                 3144 |     3144
      9525806 | 91E0_vm |                 4 | 2026-10-01 |                 3195 |     3195
      9525806 | 91E0_vm |                28 | 2026-10-01 |                 3200 |     3200
     15595153 | 6510_hua |                 9 | 2026-01-01 |                 3403 |     3403
     15595153 | 6510_hua |                 9 | 2026-07-01 |                 3404 |     3404
     17262898 | 4010    |                 9 | 2026-01-01 |                 3430 |     3430
     17262898 | 4010    |                 9 | 2026-07-01 |                 3431 |     3431
     17912057 | 91E0_vn |                 9 | 2025-10-01 |                 3453 |     3453
     17912057 | 91E0_vn |                 9 | 2026-07-01 |                 3454 |     3454
     20994606 | 7140_oli |                 9 | 2026-04-01 |                 3568 |     3568
     20994606 | 7140_oli |                 9 | 2026-10-01 |                 3569 |     3569
     23906290 | 91E0_vm |                 9 | 2026-01-01 |                 3612 |     3612
     23906290 | 91E0_vm |                 9 | 2026-07-01 |                 3613 |     3613
     27584145 | 6510_hua |                 4 | 2026-04-01 |                 3628 |     3628
     27584145 | 6510_hua |                 9 | 2024-01-01 |                 3631 |     3631
     27584145 | 6510_hua |                 9 | 2026-07-01 |                 3630 |     3630
     27584145 | 6510_hua |                 9 | 2026-10-01 |                 3629 |     3629
     27584145 | 6510_hua |                28 | 2026-04-01 |                 3635 |     3635
     29329682 | 7140_mrd |                 4 | 2026-04-01 |                 3683 |     3683
     29329682 | 7140_mrd |                 9 | 2025-10-01 |                 3684 |     3684
     29329682 | 7140_mrd |                 9 | 2026-04-01 |                 3685 |     3685
     29329682 | 7140_mrd |                 9 | 2026-10-01 |                 3686 |     3686
     29329682 | 7140_mrd |                28 | 2026-04-01 |                 3688 |     3688
     31496054 | 7140_meso |                 9 | 2026-04-01 |                 3698 |     3698
     31496054 | 7140_meso |                 9 | 2026-10-01 |                 3699 |     3699
     31682546 | 7140_meso |                 9 | 2026-01-01 |                 3724 |     3724
     31682546 | 7140_meso |                 9 | 2026-07-01 |                 3725 |     3725
     35039538 | 91E0_vo |                 9 | 2026-01-01 |                 3763 |     3763
     35039538 | 91E0_vo |                 9 | 2026-07-01 |                 3764 |     3764
     42651954 | 9190    |                 4 | 2026-04-01 |                 3834 |     3834
     42651954 | 9190    |                 9 | 2026-07-01 |                 3835 |     3835
     42651954 | 9190    |                 9 | 2026-10-01 |                 3836 |     3836
     42651954 | 9190    |                28 | 2026-04-01 |                 3838 |     3838
     44765877 | 1330_hpr |                 9 | 2026-01-01 |                 3877 |     3877
     44765877 | 1330_hpr |                 9 | 2026-07-01 |                 3878 |     3878
     47553522 | 7150    |                 9 | 2025-10-01 |                 3925 |     3925
     47553522 | 7150    |                 9 | 2026-04-01 |                 3926 |     3926
     47553522 | 7150    |                 9 | 2026-10-01 |                 3927 |     3927
     48578229 | 1310_pol |                 4 | 2026-04-01 |                 3991 |     3991
     48578229 | 1310_pol |                 9 | 2026-01-01 |                 3992 |     3992
     48578229 | 1310_pol |                 9 | 2026-07-01 |                 3993 |     3993
     48578229 | 1310_pol |                28 | 2026-04-01 |                 3997 |     3997
     50988446 | 6410_mo |                 9 | 2025-10-01 |                 4169 |     4169
     50988446 | 6410_mo |                 9 | 2026-04-01 |                 4170 |     4170
     50988446 | 6410_mo |                 9 | 2026-10-01 |                 4171 |     4171
     51431410 | 6230_hmo |                 9 | 2026-01-01 |                 4213 |     4213
     51431410 | 6230_hmo |                 9 | 2026-07-01 |                 4214 |     4214
     53288370 | 9130_fm |                 4 | 2026-10-01 |                 4287 |     4287
     53288370 | 9130_fm |                28 | 2026-10-01 |                 4294 |     4294
     57174322 | 4010    |                 9 | 2026-04-01 |                 4327 |     4327
     57174322 | 4010    |                 9 | 2026-10-01 |                 4328 |     4328
     60185305 | 91E0_va |                28 | 2026-07-01 |                 4357 |     4357
