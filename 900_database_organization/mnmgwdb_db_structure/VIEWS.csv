schema,view,query,rules,SELECT,UPDATE,purpose,excluded
inbound,FieldWork,"SELECT  LOC.*,  FwCAL.teammember_assigned,  FwCAL.activity_rank,  CASE WHEN (FwCAL.date_visit_planned IS NULL) THEN FALSE ELSE TRUE END AS is_scheduled,  FwCAL.date_visit_planned,  FwCAL.date_visit_planned - current_date AS days_to_visit,  FwCAL.date_end - current_date AS days_to_deadline,  FwCAL.notes AS preparation_notes,  SLOC.strata AS type,  VISIT.visit_id,  VISIT.teammember_id,  VISIT.date_visit,  VISIT.notes,  VISIT.photo,  VISIT.issues,  INFO.locationinfo_id,  INFO.accessibility_inaccessible,  INFO.accessibility_revisit,  INFO.recovery_hints,  INFO.landowner,  INFO.watina_code_1,  INFO.watina_code_2,  LOCEVAL.loceval_photo,  GAP.activity_group_id,  GAP.is_field_activity,  GAP.is_gw_activity,  GAP.protocols,  COALESCE( WIA.fieldwork_id, CSA.fieldwork_id) AS fieldwork_id,  CASE WHEN WIA.is_installation IS NULL THEN FALSE ELSE WIA.is_installation END AS show_installation,  CASE WHEN CSA.is_sampling IS NULL THEN FALSE ELSE CSA.is_sampling END AS show_sampling,  WIA.photo_soil_1_peilbuis,  WIA.photo_soil_2_piezometer,  WIA.photo_well,  WIA.watina_code_used_1_peilbuis,  WIA.watina_code_used_2_piezometer,  WIA.soilprofile_notes,  WIA.soilprofile_unclear,  WIA.no_diver,  WIA.random_point_number,  WIA.diver_id,  WIA.free_diver,  CSA.project_code,  CSA.recipient_code,  VISIT.visit_doneFROM ""inbound"".""Visits"" AS VISITLEFT JOIN ""metadata"".""Locations"" AS LOC  ON LOC.location_id = VISIT.location_idLEFT JOIN ""outbound"".""LocationInfos"" AS INFO  ON INFO.location_id = VISIT.location_idLEFT JOIN ""outbound"".""FieldworkCalendar"" AS FwCAL  ON FwCAL.fieldworkcalendar_id = VISIT.fieldworkcalendar_idLEFT JOIN ""outbound"".""SampleLocations"" AS SLOC  ON FwCAL.samplelocation_id = SLOC.samplelocation_idLEFT JOIN (  SELECT DISTINCT    activity_group_id,    activity_group,    is_field_activity,    is_gw_activity,    string_agg(DISTINCT('' || protocol_code || '/v' || protocol_version), E',') AS protocols  FROM ""metadata"".""GroupedActivities"" AS GACT  LEFT JOIN ""metadata"".""Protocols"" AS PRT    ON PRT.protocol_id = GACT.protocol_id  GROUP BY    activity_group_id,    activity_group,    is_field_activity,    is_gw_activity  ) AS GAP  ON GAP.activity_group_id = VISIT.activity_group_idLEFT JOIN (  SELECT *, TRUE AS is_installation  FROM ""inbound"".""WellInstallationActivities"") AS WIA  ON VISIT.visit_id = WIA.visit_idLEFT JOIN (  SELECT *, TRUE AS is_sampling  FROM ""inbound"".""ChemicalSamplingActivities"") AS CSA  ON VISIT.visit_id = CSA.visit_idLEFT JOIN (  SELECT samplelocation_id, loceval_photo  FROM (    SELECT DISTINCT      samplelocation_id,      MAX(eval_date) AS latest_visit,      eval_date,      photo AS loceval_photo    FROM ""outbound"".""LocationEvaluations"" AS LE    WHERE eval_source = 'loceval'    GROUP BY samplelocation_id, eval_date, photo  ) WHERE eval_date = latest_visit AND loceval_photo IS NOT NULL) AS LOCEVAL  ON SLOC.samplelocation_id = LOCEVAL.samplelocation_idWHERE TRUE  AND ((FwCAL.no_visit_planned IS NULL) OR (NOT FwCAL.no_visit_planned))  AND NOT FwCAL.excluded  AND GAP.is_gw_activity  AND FwCAL.archive_version_id IS NULL  AND VISIT.archive_version_id IS NULL;","DROP RULE IF EXISTS FieldWork_upd0 ON ""inbound"".""FieldWork"";CREATE RULE FieldWork_upd0 ASON UPDATE TO ""inbound"".""FieldWork""DO INSTEAD UPDATE ""inbound"".""Visits"" SET  teammember_id = NEW.teammember_id,  date_visit = NEW.date_visit,  notes = NEW.notes,  photo = NEW.photo,  issues = NEW.issues,  visit_done = NEW.visit_done WHERE visit_id = OLD.visit_id;DROP RULE IF EXISTS FieldWork_upd1 ON ""inbound"".""FieldWork"";CREATE RULE FieldWork_upd1 ASON UPDATE TO ""inbound"".""FieldWork""DO ALSO UPDATE ""outbound"".""LocationInfos"" SET  accessibility_inaccessible = NEW.accessibility_inaccessible,  accessibility_revisit = NEW.accessibility_revisit,  recovery_hints = NEW.recovery_hints WHERE locationinfo_id = OLD.locationinfo_id;DROP RULE IF EXISTS FieldWork_upd2 ON ""inbound"".""FieldWork"";CREATE RULE FieldWork_upd2 ASON UPDATE TO ""inbound"".""FieldWork""DO ALSO UPDATE ""inbound"".""WellInstallationActivities"" SET  photo_soil_1_peilbuis = NEW.photo_soil_1_peilbuis,  photo_soil_2_piezometer = NEW.photo_soil_2_piezometer,  soilprofile_notes = NEW.soilprofile_notes,  soilprofile_unclear = NEW.soilprofile_unclear,  photo_well = NEW.photo_well,  watina_code_used_1_peilbuis = NEW.watina_code_used_1_peilbuis,  watina_code_used_2_piezometer = NEW.watina_code_used_2_piezometer,  random_point_number = NEW.random_point_number,  no_diver = NEW.no_diver,  diver_id = NEW.diver_id,  free_diver = NEW.free_diver WHERE fieldwork_id = OLD.fieldwork_id;DROP RULE IF EXISTS FieldWork_upd3 ON ""inbound"".""FieldWork"";CREATE RULE FieldWork_upd3 ASON UPDATE TO ""inbound"".""FieldWork""DO ALSO UPDATE ""inbound"".""ChemicalSamplingActivities"" SET  project_code = NEW.project_code,  recipient_code = NEW.recipient_code WHERE fieldwork_id = OLD.fieldwork_id;","tom,yglinga,jens,lise,wouter,floris,karen,ward,monkey","tom,yglinga,jens,lise,wouter,floris,karen",assemble field visit info groundwater,0
inbound,MyFieldWork,"SELECT * FROM ""inbound"".""FieldWork""WHERE teammember_assigned IN (  SELECT DISTINCT teammember_id  FROM ""metadata"".""TeamMembers""  WHERE username = 'all_groundwater'    OR LOWER(username) = LOWER(current_user));",,"tom,yglinga,jens,lise,wouter,floris,karen,ward,monkey","tom,yglinga,jens,lise,wouter,floris,karen",filtered fieldwork table to show only the current user's worklist,0
outbound,FieldworkPlanning,"SELECT  LOC.*,  SLOC.scheme_ps_targetpanels,  SSPSTP.stratum_scheme_ps_targetpanels,  SLOC.schemes,  SLOC.strata,  SLOC.is_forest,  SLOC.in_mhq_samples,  SLOC.has_mhq_assessment,  SLOC.is_replacement,  REP.grts_address_poc,  INFO.locationinfo_id,  INFO.accessibility_inaccessible,  INFO.accessibility_revisit,  INFO.landowner,  INFO.recovery_hints,  INFO.watina_code_1,  INFO.watina_code_2,  FWCAL.fieldworkcalendar_id,  FWCAL.samplelocation_id,  FWCAL.date_start,  FWCAL.date_end,  FWCAL.date_interval,  FWCAL.date_end - current_date AS days_to_deadline,  FWCAL.activity_group_id,  FWCAL.activity_group_id IN (    SELECT DISTINCT activity_group_id FROM ""metadata"".""GroupedActivities""    WHERE is_gw_activity  ) AS is_gw_activity,  FWCAL.activity_rank,  FWCAL.priority,  FWCAL.wait_watersurface,  FWCAL.wait_3260,  FWCAL.wait_7220,  (FWCAL.wait_watersurface OR FWCAL.wait_3260 OR FWCAL.wait_7220) AS is_waiting,  FWCAL.excluded,  FWCAL.excluded_reason,  FWCAL.teammember_assigned,  FWCAL.date_visit_planned,  FWCAL.no_visit_planned,  FWCAL.notes,  FWCAL.done_planning,  ACT.date_visit,  ACT.has_installation,  ACT.photo,  CASE WHEN ACT.date_visit IS NULL THEN NULL       ELSE current_date - ACT.date_visit  END AS count_days_ws,  LOCEVAL.has_loceval,  LOCEVAL.latest_visitFROM ""outbound"".""FieldworkCalendar"" AS FWCALLEFT JOIN ""outbound"".""SampleLocations"" AS SLOC  ON FWCAL.samplelocation_id = SLOC.samplelocation_idLEFT JOIN ""metadata"".""Locations"" AS LOC  ON LOC.location_id = SLOC.location_idLEFT JOIN ""outbound"".""LocationInfos"" AS INFO  ON LOC.location_id = INFO.location_idLEFT JOIN ""metadata"".""SSPSTaPas"" AS SSPSTP  ON SSPSTP.sspstapa_id = FWCAL.sspstapa_idLEFT JOIN (    SELECT DISTINCT      samplelocation_id,      eval_source,      MAX(eval_date) AS latest_visit,      TRUE AS has_loceval    FROM ""outbound"".""LocationEvaluations"" AS LE    WHERE eval_source = 'loceval'    GROUP BY samplelocation_id, eval_source  ) AS LOCEVAL    ON SLOC.samplelocation_id = LOCEVAL.samplelocation_idLEFT JOIN (  SELECT DISTINCT    VISIT.samplelocation_id,    VISIT.date_visit,    VISIT.photo,    (WIA.fieldwork_id IS NOT NULL) AS has_installation  FROM ""inbound"".""Visits"" AS VISIT  LEFT JOIN ""inbound"".""WellInstallationActivities"" AS WIA    ON VISIT.visit_id = WIA.visit_id  WHERE VISIT.visit_done    AND VISIT.activity_group_id IN (      SELECT DISTINCT activity_group_id      FROM ""metadata"".""GroupedActivities""      WHERE activity_group LIKE 'GWINST%'    )    AND VISIT.archive_version_id IS NULL) AS ACT  ON FWCAL.samplelocation_id = ACT.samplelocation_idLEFT JOIN (  SELECT DISTINCT    type,    grts_address AS grts_address_poc,    grts_address_replacement AS grts_address  FROM ""archive"".""ReplacementData""  GROUP BY type, grts_address, grts_address_replacement) AS REP  ON ((REP.grts_address = SLOC.grts_address)  AND (SLOC.strata = REP.type))WHERE TRUE  AND FWCAL.archive_version_id IS NULLORDER BY  FWCAL.date_end,  FWCAL.priority,  is_waiting,  SLOC.strata,  FWCAL.grts_address,  FWCAL.activity_rank,  FWCAL.activity_group_id;","DROP RULE IF EXISTS FieldworkPlanning_upd1 ON ""outbound"".""FieldworkPlanning"";CREATE RULE FieldworkPlanning_upd1 ASON UPDATE TO ""outbound"".""FieldworkPlanning""DO INSTEAD UPDATE ""outbound"".""FieldworkCalendar"" SET  excluded = NEW.excluded,  excluded_reason = NEW.excluded_reason,  teammember_assigned = NEW.teammember_assigned,  date_visit_planned = NEW.date_visit_planned,  no_visit_planned = NEW.no_visit_planned,  notes = NEW.notes,  done_planning = NEW.done_planning WHERE fieldworkcalendar_id = OLD.fieldworkcalendar_id;DROP RULE IF EXISTS FieldworkPlanning_upd2 ON ""outbound"".""FieldworkPlanning"";CREATE RULE FieldworkPlanning_upd2 ASON UPDATE TO ""outbound"".""FieldworkPlanning""DO ALSO UPDATE ""outbound"".""LocationInfos"" SET  watina_code_1 = NEW.watina_code_1,  watina_code_2 = NEW.watina_code_2 WHERE locationinfo_id = OLD.locationinfo_id;","tom,yglinga,jens,lise,wouter,floris,karen,ward,monkey","tom,yglinga,jens,lise,wouter,floris,karen",Fieldwork preparation and planning for groundwater-related work,0
outbound,SampleCells,"SELECT *FROM ""metadata"".""LocationCells""WHERE location_id IN (  SELECT DISTINCT location_id  FROM ""outbound"".""SampleLocations""  WHERE samplelocation_id  IN (    SELECT DISTINCT samplelocation_id    FROM ""outbound"".""FieldworkCalendar""  ));",,"tom,yglinga,jens,lise,wouter,floris,karen,ward,monkey","tom,yglinga,jens,lise,wouter,floris,karen",Show grts cells of sample locations,0
outbound,LocevalInfo,"SELECT  LOC.*,  LOCEVAL.locationevaluation_id,  LOCEVAL.schemes,  LOCEVAL.type,  LOCEVAL.type_assessed,  LOCEVAL.eval_source,  LOCEVAL.eval_name,  LOCEVAL.eval_date,  LOCEVAL.notes,  LOCEVAL.photoFROM ""outbound"".""LocationEvaluations"" AS LOCEVALLEFT JOIN ""outbound"".""SampleLocations"" AS SLOC  ON (LOCEVAL.samplelocation_id = SLOC.samplelocation_id)LEFT JOIN ""metadata"".""Locations"" AS LOC  ON LOC.location_id = SLOC.location_idWHERE TRUE  AND eval_source = 'loceval';",,"tom,yglinga,jens,lise,wouter,floris,karen,ward,monkey",,all infos from loceval,0
outbound,LocationCoords,"SELECT  LOC.*,  COORDS.coordinate_id,  COORDS.wgs84_x,  COORDS.wgs84_y,  COORDS.lambert_x,  COORDS.lambert_y,  '<a href=""https://www.google.com/maps/place/' ||    CAST(COORDS.wgs84_y AS VARCHAR) ||    ',' ||    CAST(COORDS.wgs84_x AS VARCHAR) ||    '""> google </a>, <br><br> ' ||  '<a href=""https://www.openstreetmap.org/?mlat=' ||    CAST(COORDS.wgs84_y AS VARCHAR) ||    '&mlon=' ||    CAST(COORDS.wgs84_x AS VARCHAR) ||    '""> openstreetmap </a>, <br><br> ' ||  '<a href=""https://waze.com/ul?ll=' ||    CAST(COORDS.wgs84_y AS VARCHAR) ||    ',' ||    CAST(COORDS.wgs84_x AS VARCHAR) ||    '""> waze </a>'    AS google_linkFROM ""metadata"".""Locations"" AS LOCLEFT JOIN ""metadata"".""Coordinates"" AS COORDS  ON COORDS.location_id = LOC.location_idWHERE LOC.location_id IS NOT NULL  AND COORDS.location_id IS NOT NULL;",,"tom,yglinga,jens,lise,wouter,floris,karen,ward,monkey",,coordinates in BD72 and WGS84 for car navigation,0
outbound,MHQSafety,"SELECT *FROM ""outbound"".""MHQPolygons""WHERE samplelocation_id IN (    SELECT DISTINCT samplelocation_id    FROM ""outbound"".""LocationEvaluations""    WHERE eval_source = 'loceval'  );",,"tom,yglinga,jens,lise,wouter,floris,karen,ward,monkey",,MHQ safety polygon,0
outbound,RandomCellPoints,"SELECT *FROM ""outbound"".""RandomPoints""WHERE samplelocation_id IN (    SELECT DISTINCT samplelocation_id    FROM ""outbound"".""LocationEvaluations""    WHERE eval_source = 'loceval'  );",,"tom,yglinga,jens,lise,wouter,floris,karen,ward,monkey",,random points for well placement,0
outbound,MissingTeammember,"SELECT DISTINCT LOC.*FROM ""outbound"".""FieldworkCalendar"" AS FwCalLEFT JOIN ""outbound"".""SampleLocations"" AS SLOC  ON FwCal.samplelocation_id = SLOC.samplelocation_idLEFT JOIN ""metadata"".""Locations"" AS LOC  ON LOC.location_id = SLOC.location_idWHERE done_planning  AND teammember_assigned IS NULL  AND NOT excluded  AND NOT no_visit_planned;",,"tom,yglinga,jens,lise,wouter,floris,karen,ward,monkey",,planning: forgotten to add teammember_id,0
