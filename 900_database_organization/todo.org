#+title: TODO

* mainline
+ [X] credentials to config
+ [X] =UNIQUE= tag? -> constraints added
+ [-] migration and real test
  + [X] activity calendar
  + [X] activities executed -> "Visits"
  + [X] stratum to LocCal
  + [ ] a unique identifier for =fag_stratum_grts_calendar_2025_attribs_sf= (fag+grts? database?)
  + [X] there are unmatched *activities* (join) -> define meaningful set of activities with human-readable description
  + [X] there are non-unique LocationCalendar entries, smushed before upload
  + [X] handle *teammembers* (meta data table); e.g. for planning =Visits=
+ [X] test import to =pgmodeler= for visualization
+ [X] Visits: outsource a table with "locations due", linking to LocationCalendar
  + [X] subset which is due for a visit
  + [X] different schema -> it might be necessary to lookup schema in the python generator procedure
  + [X] date scheduled; user assigned -> via desktop work (qgis project)
  + [X] +regularly updated with stored procedure or python script+ auto-pushed
  + [X] column "done" is fed back to LocationCalendar
+ [X] play with "read/write" permissions of user role =ward= via qgis/qfield
  + [X] sequence references seem to be an issue (ROLE->SEQUENCE?)
+ [X] =teammember_id=:
  + [X] =teammember_id= columns
  + [X] or dropdown for form edit (=Teammembers= table ⊂ =metadata= schema?)
+ [ ] inbound forms
  + [ ] =Visits= -> structured input
  + [ ] =FieldNotes= -> free input
+ recurrent tasks
  + [ ] backup procedures via cron
  + [ ] =Visits=: due/overdue update
+ [ ] forms refinement
  + [ ] aliases? (via postgres or qfield)
  + [ ] accessibility layer
+ [ ] database mirrors: one for me to play (=loceval_dev=), one for the real work (=loceval=)
  + [ ] safe checks for updating a production database
+ [ ] qgis/database convenience
  + [ ] fill username automatically upon edit
  + [ ] store edit dates -> "append-only" + views?
+ [ ] second db with third schema: =mnmdb=
  + [ ] mirror/assembly of previously collected data
  + [ ] can live on a completely different connection
  + [ ] replace image blobs with file links upon import
+ [-] images and how to bring them home
  + [X] BLOB (binary large objects) work as =bytea= data type [[https://www.postgresql.org/docs/current/datatype-binary.html][(see here)]]
  + [ ] test qfield camera usage
  + [ ] test downloading and compression/update workflow
+ [ ] backup procedures
+ [ ] generalize R functions, to package files
  + =append_tabledata=
  + =upload_and_lookup=
+ [-] qfield integration
  + [X] where is the qgis qfield export gone? *[!]* -> gdal error solved
  + [X] postgis login from qfield; auth with master password? set ID!
  + [ ] [[https://docs.qfield.org/how-to/pictures/#drawing-templates][qfield drawing templates]]
  + [ ] [[https://docs.qfield.org/how-to/pictures/#configurable-attachment-path][attachment path]]
  + [X] select/join from multiple tables; alternatively auto-generate data+metadata -> postgres views views
+ [ ] generic database ROLEs (extra layer btw db user and permission; simplifies adding new database users to certain tasks)
  + [ ] roles defined
  + [ ] adjust upload scripts
+ [ ] Activity Roles
  + [ ] for now: solved by group members in =TeamMembers=
  + [ ] add =role= to =TeamMembers=
  + [ ] link =GroupedActivities= to roles -> who does what? filter?
+ [X] offline caching in qfield? -> works well
+ [ ] bring to tablet
+ [ ] manual, ex post python check to constrain =LocationCalendar.activity_group_id= to valid values
+ [X] fix qgis installation
+ [ ] migrate to AWS: database + ec2 + s3
  + [ ] backups to s3
  + [ ] create postgis docker for db
    + user handling?
    + updates?
  + [ ] organize with ICT/Jens (timing!)
  + [ ] backup and maintenance procedures to ec2
  + [ ] keep current node for =*_dev=



* optional
+ save/restore a whole =db_structure= in pandas tables
+ check =wk::as_wkb()=
    #+begin_quote
    Een beetje experimentering met database-geometrieën vind je in deze code <https://github.com/inbo/n2khab-preprocessing/blob/1bf89599398b1b1be121fe84dcedec5623a8a576/src/miscellaneous/watersurfaces.Rmd#L76-L120>.
    Inspiratie kwam van https://hydroecology.net/reading-spatial-data-from-sql-server-without-sf/
    #+end_quote

+ array data types (e.g. =panel_set=) -> upload with dplyr tricky (str -> int[])

+ bug report: =sf::dbWriteTable()= seems to overwrite boolean defaults
